<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MoodShare Admin</title>
    <link rel="stylesheet" href="admin.css" />
  </head>
  <body>
    <!-- ===== LOGIN SCREEN ===== -->
    <div id="login-screen">
      <div class="login-card">
        <div class="login-badge">Administration</div>
        <h1 class="login-title">MoodShare<br /><span>Admin Panel</span></h1>
        <p class="login-sub">Acc√®s r√©serv√© aux administrateurs.</p>

        <div class="field">
          <label>Identifiant</label>
          <input
            type="text"
            id="login-id"
            placeholder="Identifiant admin"
            autocomplete="off"
          />
        </div>

        <div class="field">
          <label>Mot de passe</label>
          <input
            type="password"
            id="login-password"
            placeholder="Mot de passe admin"
          />
        </div>

        <button id="attemptlogin" class="login-btn">Connexion ‚Üí</button>
        <div class="login-error" id="login-error">
          Identifiants invalides. Acc√®s refus√©.
        </div>
      </div>
    </div>

    <!-- ===== ADMIN SCREEN ===== -->
    <div id="admin-screen">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-logo">
          <div class="sidebar-logo-label">MoodShare</div>
          <div class="sidebar-logo-name"><span>Admin</span> Panel</div>
        </div>

        <div class="sidebar-section">Navigation</div>

        <div
          class="nav-item active"
          onclick="showPage('dashboard')"
          data-page="dashboard"
        >
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <rect x="3" y="3" width="7" height="7" rx="1" />
            <rect x="14" y="3" width="7" height="7" rx="1" />
            <rect x="3" y="14" width="7" height="7" rx="1" />
            <rect x="14" y="14" width="7" height="7" rx="1" />
          </svg>
          <span class="nav-label">Tableau de bord</span>
        </div>

        <div class="nav-item" onclick="showPage('posts')" data-page="posts">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
            />
          </svg>
          <span class="nav-label">Posts</span>
        </div>

        <div class="nav-item" onclick="showPage('reports')" data-page="reports">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"
            />
            <line x1="12" y1="9" x2="12" y2="13" />
            <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
          <span class="nav-label">Signalements</span>
          <span class="nav-badge" id="reports-badge" style="display: none"
            >0</span
          >
        </div>

        <div class="nav-item" onclick="showPage('stories')" data-page="stories">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <circle cx="12" cy="12" r="10" />
            <polyline points="12 6 12 12 16 14" />
          </svg>
          <span class="nav-label">Stories</span>
        </div>

        <div class="nav-item" onclick="showPage('create')" data-page="create">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="16" />
            <line x1="8" y1="12" x2="16" y2="12" />
          </svg>
          <span class="nav-label">Cr√©er un post</span>
        </div>

        <div class="nav-item" onclick="showPage('pinned')" data-page="pinned">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 21 12 17.77 5.82 21 7 14.14 2 9.27l6.91-1.01L12 2z"
            />
          </svg>
          <span class="nav-label">Annonces</span>
        </div>
        <div
          class="nav-item"
          onclick="showPage('settings')"
          data-page="settings"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"
            />
            <circle cx="12" cy="12" r="3" />
          </svg>
          <span class="nav-label">Param√®tres serveur</span>
        </div>

        <div class="sidebar-footer">
          <div class="admin-tag">
            <div class="admin-tag-dot"></div>
            <span class="admin-tag-text" style="font-size: 15px; color: white"
              >Admin</span
            >
          </div>
          <button class="logout-btn" onclick="doLogout()">D√©connexion</button>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="main">
        <!-- DASHBOARD PAGE -->
        <div class="page active" id="page-dashboard">
          <div class="page-header">
            <div>
              <div class="page-title">Tableau de bord</div>
              <div class="page-subtitle">Vue d'ensemble de MoodShare</div>
            </div>
            <button class="btn btn-ghost" onclick="loadAll()">
              <span id="refresh-spinner" style="display: none"
                ><span class="spinner"></span
              ></span>
              Actualiser
            </button>
          </div>

          <div class="stat-grid" id="stat-grid">
            <div class="stat-card">
              <div class="stat-label">Posts totaux</div>
              <div class="stat-value accent" id="stat-posts">‚Äî</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Stories actives</div>
              <div class="stat-value success" id="stat-stories">‚Äî</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Signalements</div>
              <div class="stat-value danger" id="stat-reports">‚Äî</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Posts √©ph√©m√®res</div>
              <div class="stat-value warn" id="stat-ephemeral">‚Äî</div>
            </div>
          </div>

          <div class="quick-grid">
            <div class="quick-card" onclick="showPage('create')">
              <div
                class="quick-card-icon"
                style="background: rgba(0, 207, 235, 0.1)"
              >
                ‚úçÔ∏è
              </div>
              <div class="quick-card-label">Cr√©er un post</div>
              <div class="quick-card-sub">Publier en tant qu'admin</div>
            </div>
            <div class="quick-card" onclick="showPage('reports')">
              <div
                class="quick-card-icon"
                style="background: rgba(239, 68, 68, 0.1)"
              >
                üö®
              </div>
              <div class="quick-card-label">Voir les signalements</div>
              <div class="quick-card-sub">Mod√©rer le contenu</div>
            </div>
            <div class="quick-card" onclick="showPage('posts')">
              <div
                class="quick-card-icon"
                style="background: rgba(34, 197, 94, 0.1)"
              >
                üìã
              </div>
              <div class="quick-card-label">G√©rer les posts</div>
              <div class="quick-card-sub">√âditer ou supprimer</div>
            </div>
            <div class="quick-card" onclick="showPage('stories')">
              <div
                class="quick-card-icon"
                style="background: rgba(245, 158, 11, 0.1)"
              >
                ‚è∞
              </div>
              <div class="quick-card-label">Voir les stories</div>
              <div class="quick-card-sub">Stories en cours</div>
            </div>
            <div class="quick-card" onclick="showPage('pinned')">
              <div
                class="quick-card-icon"
                style="background: rgba(251, 191, 36, 0.1)"
              >
                üìå
              </div>
              <div class="quick-card-label">Annonces</div>
              <div class="quick-card-sub">Posts permanents</div>
            </div>
          </div>

          <div class="table-wrapper">
            <div class="table-header">
              <div class="table-title">Les 15 derniers posts</div>
            </div>
            <div id="dash-recent"></div>
          </div>
        </div>

        <!-- POSTS PAGE -->
        <div class="page" id="page-posts">
          <div class="page-header">
            <div>
              <div class="page-title">Posts</div>
              <div class="page-subtitle">Gestion compl√®te des posts</div>
            </div>
            <div class="table-actions">
              <input
                class="search-input"
                type="text"
                id="post-search"
                placeholder="Rechercher‚Ä¶"
                oninput="filterPosts()"
              />
              <button class="btn btn-primary" onclick="showPage('create')">
                + Nouveau post
              </button>
            </div>
          </div>
          <div class="table-wrapper">
            <div class="table-header">
              <div class="table-title">Tous les posts</div>
              <span id="posts-count" class="date-muted"></span>
            </div>
            <div id="posts-table"></div>
          </div>
        </div>

        <!-- REPORTS PAGE -->
        <div class="page" id="page-reports">
          <div class="page-header">
            <div>
              <div class="page-title">Signalements</div>
              <div class="page-subtitle">
                Contenu signal√© par les utilisateurs
              </div>
            </div>
            <button class="btn btn-ghost" onclick="renderReports()">
              Actualiser
            </button>
          </div>
          <div id="reports-list"></div>
        </div>

        <!-- STORIES PAGE -->
        <div class="page" id="page-stories">
          <div class="page-header">
            <div>
              <div class="page-title">Stories</div>
              <div class="page-subtitle">Stories actuellement actives</div>
            </div>
          </div>
          <div id="stories-table"></div>
        </div>

        <!-- CREATE POST PAGE -->
        <div class="page" id="page-create">
          <div class="page-header">
            <div>
              <div class="page-title">Cr√©er un post</div>
              <div class="page-subtitle">
                Publication admin ‚Äî bypass des restrictions
              </div>
            </div>
          </div>

          <div class="table-wrapper" style="max-width: 600px">
            <div class="table-header">
              <div class="table-title">Nouveau post</div>
            </div>
            <div style="padding: 24px">
              <div class="modal-field">
                <label>Texte du post</label>
                <textarea
                  id="create-text"
                  placeholder="√âcris ton mood ici‚Ä¶"
                  rows="3"
                  style="
                    width: 100%;
                    background: var(--surface2);
                    border: 1px solid var(--border);
                    border-radius: 10px;
                    padding: 10px 14px;
                    color: var(--text);
                    font-size: 13px;
                    outline: none;
                    resize: vertical;
                  "
                ></textarea>
              </div>
              <div class="modal-row">
                <div class="modal-field">
                  <label>Emoji</label>
                  <input
                    type="text"
                    id="create-emoji"
                    placeholder="üòä"
                    maxlength="8"
                    style="font-size: 22px"
                  />
                </div>
                <div class="modal-field">
                  <label>Couleur fond</label>
                  <input type="color" id="create-color" value="#00cfeb" />
                </div>
                <div class="modal-field">
                  <label>Couleur texte</label>
                  <input type="color" id="create-textcolor" value="#000000" />
                </div>
              </div>

              <!-- Live preview -->
              <div style="margin: 16px 0 8px">
                <div class="modal-field" style="margin: 0">
                  <label>Aper√ßu</label>
                  <div
                    id="create-preview"
                    class="preview-bubble"
                    style="background: #00cfeb; color: #000"
                  >
                    <span id="prev-emoji">üòä</span>
                    <span id="prev-text">Texte du post‚Ä¶</span>
                  </div>
                </div>
              </div>

              <div
                style="
                  display: flex;
                  gap: 12px;
                  margin-top: 20px;
                  flex-wrap: wrap;
                "
              >
                <button class="btn btn-primary" onclick="adminCreatePost()">
                  Publier le post ‚Üí
                </button>
                <button class="btn btn-ghost" onclick="showPage('posts')">
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- PINNED / ANNONCES PAGE -->
        <div class="page" id="page-pinned">
          <div class="page-header">
            <div>
              <div class="page-title">üìå Annonces & Posts permanents</div>
              <div class="page-subtitle">
                Ces posts survivent aux red√©marrages serveur via MongoDB
              </div>
            </div>
            <button class="btn btn-primary" onclick="openPinnedModal()">
              + Nouvelle annonce
            </button>
          </div>

          <!-- Info MongoDB -->
          <div
            id="pinned-mongo-status"
            style="
              margin-bottom: 20px;
              padding: 12px 16px;
              border-radius: 10px;
              font-size: 12px;
              background: rgba(245, 158, 11, 0.08);
              border: 1px solid rgba(245, 158, 11, 0.2);
              color: var(--warn);
              display: none;
            "
          >
            ‚ö†Ô∏è MongoDB non connect√© ‚Äî les annonces ne survivront pas aux
            red√©marrages. Configure <code>MONGO_URI</code> sur Render.
          </div>

          <div id="pinned-list"></div>
        </div>
        <div class="page" id="page-settings">
          <div class="page-header">
            <div>
              <div class="page-title">‚öôÔ∏è Param√®tres serveur</div>
              <div class="page-subtitle">
                Configuration et √©tat de la connexion √† MongoDB
              </div>
            </div>
          </div>
          <div id="settings-content" style="margin-top: 12px">

          </div>
        </div>
      </main>
    </div>

    <!-- EDIT MODAL -->
    <div class="modal-overlay" id="edit-modal">
      <div class="modal">
        <div class="modal-title">‚úèÔ∏è Modifier le post</div>
        <input type="hidden" id="edit-post-id" />
        <div class="modal-field">
          <label>Texte</label>
          <textarea id="edit-text" rows="3"></textarea>
        </div>
        <div class="modal-row">
          <div class="modal-field">
            <label>Emoji</label>
            <input
              type="text"
              id="edit-emoji"
              maxlength="8"
              style="font-size: 20px"
            />
          </div>
          <div class="modal-field">
            <label>Couleur fond</label>
            <input type="color" id="edit-color" />
          </div>
          <div class="modal-field">
            <label>Couleur texte</label>
            <input type="color" id="edit-textcolor" />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-ghost" onclick="closeModal('edit-modal')">
            Annuler
          </button>
          <button class="btn btn-primary" onclick="saveEdit()">
            Sauvegarder
          </button>
        </div>
      </div>
    </div>

    <!-- CONFIRM DELETE MODAL -->
    <div class="modal-overlay" id="delete-modal">
      <div class="modal" style="max-width: 380px">
        <div class="modal-title">üóëÔ∏è Supprimer le post ?</div>
        <p style="font-size: 13px; color: var(--muted); margin-bottom: 20px">
          Cette action est irr√©versible. Le post sera d√©finitivement supprim√©.
        </p>
        <input type="hidden" id="delete-post-id" />
        <div class="modal-footer">
          <button class="btn btn-ghost" onclick="closeModal('delete-modal')">
            Annuler
          </button>
          <button class="btn btn-danger" onclick="confirmDelete()">
            Supprimer
          </button>
        </div>
      </div>
    </div>

    <!-- PINNED POST MODAL -->
    <div class="modal-overlay" id="pinned-modal">
      <div class="modal" style="max-width: 520px">
        <div class="modal-title">üìå Nouvelle annonce</div>
        <p style="font-size: 12px; color: var(--muted); margin: -8px 0 16px">
          Ce post sera √©pingl√© en haut du feed et persistera entre les
          red√©marrages serveur.
        </p>

        <div class="modal-field">
          <label>Type d'annonce</label>
          <select
            id="pinned-label"
            style="
              width: 100%;
              background: var(--surface2);
              border: 1px solid var(--border);
              border-radius: 10px;
              padding: 10px 14px;
              color: var(--text);
              font-size: 13px;
              outline: none;
              appearance: none;
            "
          >
            <option value="üì¢ Annonce">üì¢ Annonce</option>
            <option value="üéâ √âv√©nement">üéâ √âv√©nement</option>
            <option value="üîß Maintenance">üîß Maintenance</option>
            <option value="‚ö° Mise √† jour">‚ö° Mise √† jour</option>
            <option value="üö® Urgent">üö® Urgent</option>
            <option value="üí° Info">üí° Info</option>
          </select>
        </div>

        <div class="modal-field">
          <label>Texte de l'annonce</label>
          <textarea
            id="pinned-text"
            rows="3"
            placeholder="Contenu de l'annonce‚Ä¶"
          ></textarea>
        </div>

        <div class="modal-row">
          <div class="modal-field">
            <label>Emoji</label>
            <input
              type="text"
              id="pinned-emoji"
              placeholder="üì¢"
              maxlength="8"
              style="font-size: 22px"
            />
          </div>
          <div class="modal-field">
            <label>Couleur fond</label>
            <input type="color" id="pinned-color" value="#f59e0b" />
          </div>
          <div class="modal-field">
            <label>Couleur texte</label>
            <input type="color" id="pinned-textcolor" value="#000000" />
          </div>
        </div>

        <!-- Aper√ßu live -->
        <div class="modal-field" style="margin-top: 4px">
          <label>Aper√ßu</label>
          <div
            id="pinned-preview"
            class="preview-bubble"
            style="background: #f59e0b; color: #000; flex-wrap: wrap; gap: 4px"
          >
            <span
              id="pinned-prev-label"
              style="font-size: 10px; opacity: 0.7; letter-spacing: 0.08em"
            ></span>
            <span id="pinned-prev-emoji">üì¢</span>
            <span id="pinned-prev-text">Texte de l'annonce‚Ä¶</span>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-ghost" onclick="closeModal('pinned-modal')">
            Annuler
          </button>
          <button class="btn btn-primary" onclick="createPinnedPost()">
            üìå √âpingler
          </button>
        </div>
      </div>
    </div>

    <!-- EMERGENCY RESTART MODAL -->
    <div class="modal-overlay" id="emergency-modal">
      <div class="modal" style="max-width: 420px">
        <div class="modal-title">üö® Red√©marrage d'urgence</div>
        <p style="font-size: 12px; color: var(--muted); margin: 0 0 16px">
          Cette action red√©marre les connexions (MongoDB, SSE, etc.).
          <strong>Cette action est critique.</strong>
        </p>

        <div style="background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 10px; padding: 12px; margin-bottom: 16px; font-size: 12px; color: var(--warn);">
          ‚ö†Ô∏è <strong>Tous les clients connect√©s seront d√©connect√©s.</strong>
        </div>

        <div class="modal-field">
          <label>Mot de passe admin</label>
          <input 
            type="password" 
            id="emergency-password" 
            placeholder="Mot de passe admin"
            style="width: 100%; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text); font-size: 13px; outline: none;"
          />
        </div>

        <div class="modal-field">
          <label>Commande de confirmation</label>
          <input 
            type="text" 
            id="emergency-command" 
            placeholder="Tapez RESTART_NOW"
            style="width: 100%; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text); font-size: 13px; outline: none; font-family: monospace; font-weight: 600;"
          />
        </div>

        <div id="emergency-error" style="display: none; color: var(--danger); font-size: 12px; margin-bottom: 12px; padding: 10px; background: rgba(239, 68, 68, 0.1); border-radius: 6px; border-left: 3px solid var(--danger);"></div>

        <div class="modal-footer">
          <button class="btn btn-ghost" onclick="closeModal('emergency-modal')">
            Annuler
          </button>
          <button class="btn btn-danger" onclick="confirmEmergencyRestart()">
            üö® Confirmer le red√©marrage
          </button>
        </div>
      </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div id="toast-container"></div>
    <script src="admin.js"></script>
  </body>
</html>
